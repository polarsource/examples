---
import { polar } from '@/lib/polar'
import Layout from '@/layouts/Layout.astro'

let checkout = null
let product = null

const checkoutId = Astro.url.searchParams.get('checkoutId')
if (checkoutId) {
  checkout = await polar.checkouts.get({ id: checkoutId })
  if (checkout.productId) product = await polar.products.get({ id: checkout.productId })
}
---

<Layout title="Purchase Successful | PolarSource">
  <section class="pt-4 pb-16">
    <div class="container mx-auto px-4 text-center">
      {
        checkout && product ? (
          <div class="max-w-2xl mx-auto">
            <div class="w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-8 h-8 text-accent-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h1 class="text-4xl font-heading font-bold text-primary mb-4">Purchase Successful!</h1>
            <p class="text-xl text-muted-foreground mb-8">Thank you for your purchase. You now have access to:</p>
            <div class="bg-card border border-border rounded-lg p-6 mb-8">
              <h2 class="text-2xl font-heading font-semibold text-card-foreground mb-2">{product.name}</h2>
              <p class="text-muted-foreground mb-4">{product.description}</p>
              <div class="text-lg font-semibold text-primary">Order ID: {checkout.id}</div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <a href="/customer-portal" class="px-6 py-3 bg-primary text-primary-foreground font-medium rounded-lg hover:bg-primary/90 transition-colors">
                Access Customer Portal
              </a>
              <a href="/" class="px-6 py-3 bg-secondary text-secondary-foreground font-medium rounded-lg hover:bg-secondary/90 transition-colors">
                Browse More Products
              </a>
            </div>
          </div>
        ) : (
          <div class="max-w-md mx-auto">
            <h1 class="text-3xl font-heading font-bold text-primary mb-4">Invalid Session</h1>
            <p class="text-muted-foreground mb-6">We couldn't find your purchase details. Please check your email for confirmation.</p>
            <a href="/" class="inline-flex px-6 py-3 bg-primary text-primary-foreground font-medium rounded-lg hover:bg-primary/90 transition-colors">
              Return to Home
            </a>
          </div>
        )
      }
    </div>
  </section>
</Layout>
